<!DOCTYPE html>
<html lang="zh-CN">
  <head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge"><title>Snow Wang</title>
    
<link rel="icon" type="image/png" href="/images/favicon.png" />


<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet"><link rel="stylesheet" type="text/css" href="/style.sass" integrity="">
<link rel="stylesheet" type="text/css" href="/css/monokai-sublime.9.15.8.min.min.3a5d282f03108101d715e80fd4c07b55502ec4673fc063f2b6e415d4def5b354.css" integrity="sha256-Ol0oLwMQgQHXFegP1MB7VVAuxGc/wGPytuQV1N71s1Q=">
<link rel="stylesheet" type="text/css" href="/css/icons.min.6dc06ab2f3698408961127b959a0f87ba0426dfa1df4cb25a55fa434db7222c5.css" integrity="sha256-bcBqsvNphAiWESe5WaD4e6BCbfod9MslpV&#43;kNNtyIsU=">
<link rel="stylesheet" type="text/css" href="/css/refresh-css.min.4150dea8b1163110505480d97b50425998cd09b589f3ce9f9c36cd2ce2dc64c3.css" integrity="sha256-QVDeqLEWMRBQVIDZe1BCWZjNCbWJ886fnDbNLOLcZMM=">
<link rel="stylesheet" type="text/css" href="/css/devicon.min.min.13fddf418611477a10293a87542de7703396184696bd8cf50642c4c72994c78a.css" integrity="sha256-E/3fQYYRR3oQKTqHVC3ncDOWGEaWvYz1BkLExymUx4o=">

  </head>
  <body>
    
    <div id="preloader">
      <div id="status"></div>
    </div><nav class="navbar is-fresh is-transparent no-shadow" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">

      
      
      
      <a class="navbar-item">
        <div class="menu-icon-wrapper left-menu-icon-wrapper" style="visibility: visible;">
          <svg width="1000px" height="1000px">
            <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
            <path class="path2" d="M 300 500 L 700 500"></path>
            <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
          </svg>
          <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
        </div>
        <div class="navbar-item left-menu-icon-wrapper">Tags</div>
      </a>
      <div class="navbar-item is-expanded"><a class="navbar-item" href="http://www.farseer.vip"><div >HOME</div></a></div>
      <a class="navbar-item is-hidden-desktop">  
        <div data-target="navbar-menu" class="navbar-item right-menu-icon-wrapper is-hidden-desktop">Menu</div>
        <div data-target="navbar-menu" class="menu-icon-wrapper right-menu-icon-wrapper" style="visibility: visible;">
          <svg width="1000px" height="1000px">
            <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
            <path class="path2" d="M 300 500 L 700 500"></path>
            <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
          </svg>
          <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
        </div>
      </a>
    </div>

    <div id="navbar-menu" class="navbar-menu is-static">
      
      <div class="navbar-end">
        <a href="/about/" class="navbar-item is-secondary">About Me</a><a href="/blog/" class="navbar-item is-secondary">Blog</a>
          <div class="navbar-item has-dropdown is-hoverable">
            <a href="/diary/" class="navbar-link">Diary</a>
            <div class="navbar-dropdown">

              <a href="/diary/2023/" class="navbar-item">Year of 2023</a><a href="/diary/2022/" class="navbar-item">Year of 2022</a><a href="/diary/2021/" class="navbar-item">Year of 2021</a><a href="/diary/2020/" class="navbar-item">Year of 2020</a><a href="/diary/2019/" class="navbar-item">Year of 2019</a><a href="/diary/2018/" class="navbar-item">Year of 2018</a><a href="/diary/2017/" class="navbar-item">Year of 2017</a><a href="/diary/2016/" class="navbar-item">Year of 2016</a><a href="/diary/2015/" class="navbar-item">Year of 2015</a><a href="/diary/2014/" class="navbar-item">Year of 2014</a><a href="/diary/2013/" class="navbar-item">Year of 2013</a><a href="/diary/2012/" class="navbar-item">Year of 2012</a><a href="/diary/2011/" class="navbar-item">Year of 2011</a><a href="/diary/2010/" class="navbar-item">Year of 2010</a><a href="/diary/2009/" class="navbar-item">Year of 2009</a><a href="/diary/2008/" class="navbar-item">Year of 2008</a><a href="/diary/2007/" class="navbar-item">Year of 2007</a></div>
          </div></div>
    </div>
  </div>
</nav><nav id="navbar-clone" class="navbar is-fresh is-transparent" role="navigation" aria-label="main navigation">
  <div class="container">
      <div class="navbar-brand">
  
        
        
        
        <a class="navbar-item">
          <div class="menu-icon-wrapper left-menu-icon-wrapper" style="visibility: visible;">
            <svg width="1000px" height="1000px">
              <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
              <path class="path2" d="M 300 500 L 700 500"></path>
              <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
            </svg>
            <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
          </div>
          <div class="navbar-item left-menu-icon-wrapper">Tags</div>
        </a>
  
        <div class="navbar-item is-expanded"><a class="navbar-item" href="http://www.farseer.vip"><div >HOME</div></a></div>
        <a class="navbar-item is-hidden-desktop">  
          <div data-target="cloned-navbar-menu" class="navbar-item right-menu-icon-wrapper is-hidden-desktop">Menu</div>
          <div data-target="cloned-navbar-menu" class="menu-icon-wrapper right-menu-icon-wrapper" style="visibility: visible;">
            <svg width="1000px" height="1000px">
              <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
              <path class="path2" d="M 300 500 L 700 500"></path>
              <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
            </svg>
            <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
          </div>
        </a>
      </div>
  
      
  
      <div id="cloned-navbar-menu" class="navbar-menu is-static">
        <div class="navbar-end">
          <a href="/about/" class="navbar-item is-secondary">About Me</a><a href="/blog/" class="navbar-item is-secondary">Blog</a><div class="navbar-item has-dropdown is-hoverable">
              <a href="/diary/" class="navbar-link">Diary</a>
              <div class="navbar-dropdown">
                <a href="/diary/2023/" class="navbar-item">Year of 2023</a><a href="/diary/2022/" class="navbar-item">Year of 2022</a><a href="/diary/2021/" class="navbar-item">Year of 2021</a><a href="/diary/2020/" class="navbar-item">Year of 2020</a><a href="/diary/2019/" class="navbar-item">Year of 2019</a><a href="/diary/2018/" class="navbar-item">Year of 2018</a><a href="/diary/2017/" class="navbar-item">Year of 2017</a><a href="/diary/2016/" class="navbar-item">Year of 2016</a><a href="/diary/2015/" class="navbar-item">Year of 2015</a><a href="/diary/2014/" class="navbar-item">Year of 2014</a><a href="/diary/2013/" class="navbar-item">Year of 2013</a><a href="/diary/2012/" class="navbar-item">Year of 2012</a><a href="/diary/2011/" class="navbar-item">Year of 2011</a><a href="/diary/2010/" class="navbar-item">Year of 2010</a><a href="/diary/2009/" class="navbar-item">Year of 2009</a><a href="/diary/2008/" class="navbar-item">Year of 2008</a><a href="/diary/2007/" class="navbar-item">Year of 2007</a></div>
            </div></div>
      </div>
  
  
  
  
    </div>
  </nav>
<section class="section is-medium">
  <div class="container">
    <div class="columns">
      <div class="column is-centered-tablet-portrait">
        <h1 class="title is-2 section-title">Python 修改 logging 时间</h1>
        <h5 class="subtitle is-5 is-muted"></h5>
        <div class="divider"></div>
        
        <section class="section content has-text-justified">
          <h2 id="发生环境">发生环境：</h2>
<p><em>Python3+、docker-18.03</em></p>
<h2 id="问题描述">问题描述：</h2>
<p>　　最近需要写日志来查看下程序的总体运行情况，另外代码是直接丢进<code>docker</code>中部署的，发现输出的日志时间与本地时间相差8小时，因为<code>docker</code>的本地时间在镜像<code>build</code>时候就设置成了北京时间，所以第一个感觉是<code>logging</code>模块的默认时间可能是根本问题。</p>
<p>日志输出的时间：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">12</span><span style="color:#f92672">-</span><span style="color:#ae81ff">11</span> <span style="color:#ae81ff">14</span>:<span style="color:#ae81ff">01</span>:<span style="color:#ae81ff">16.00276</span> INFO:apscheduler<span style="color:#f92672">.</span>executors<span style="color:#f92672">.</span>default:Running job
</span></span></code></pre></div><p>查询本地时间（docker容器内部时间）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Wed Dec <span style="color:#ae81ff">11</span> 22:01:16 CST <span style="color:#ae81ff">2019</span>
</span></span></code></pre></div><p><em>搜了很多地方，最后还是很无奈的妥妥地去了官网
<code>https://docs.python.org/3/howto/logging.html</code></em></p>
<p>有一段话解释了logging使用的时间：</p>
<blockquote>
<p>Formatters use a user-configurable function to convert the creation time of a record to a tuple. By default, time.localtime() is used; to change this for a particular formatter instance, set the converter attribute of the instance to a function with the same signature as time.localtime() or time.gmtime(). To change it for all formatters, for example if you want all logging times to be shown in GMT, set the converter attribute in the Formatter class (to time.gmtime for GMT display).</p>
</blockquote>
<p><strong>总结一下就是</strong>：<code>logging</code>默认使用的是<code>time.localtime()</code>，如果要使用其他时间需要使用<code>Formatter</code>下的<code>converter</code>重定义。<code>time.localtime()</code>的时间使用的是
<a href="https://docs.python.org/3/library/time.html#time.localtime">time.time()</a>, 而<code>time.time()</code>返回的是<a href="https://docs.python.org/3/library/time.html#time.time">UTC时间</a>，即从 1970-1-1 00:00:00 到现在的秒数，因此时间相差8小时。</p>
<h2 id="解决办法">解决办法：</h2>
<p>最后改了下代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">CST</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># UTC与CST相差8小时</span>
</span></span><span style="display:flex;"><span>    cst <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>now() <span style="color:#f92672">+</span> datetime<span style="color:#f92672">.</span>timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cst<span style="color:#f92672">.</span>timetuple()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 修改日志默认时区</span>
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>Formatter<span style="color:#f92672">.</span>converter <span style="color:#f92672">=</span> CST
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO,
</span></span><span style="display:flex;"><span>                    format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%(asctime)s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%(filename)s</span><span style="color:#e6db74">[line:</span><span style="color:#e6db74">%(lineno)d</span><span style="color:#e6db74">] </span><span style="color:#e6db74">%(levelname)s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%(message)s</span><span style="color:#e6db74">&#39;</span>,
</span></span><span style="display:flex;"><span>                    datefmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> %H:%M:%S&#39;</span>,
</span></span><span style="display:flex;"><span>                    filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log.txt&#39;</span>,
</span></span><span style="display:flex;"><span>                    filemode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;a&#39;</span>)
</span></span></code></pre></div>
        </section>
      </div>
    </div>
  </div>  
  </section><footer class="footer footer-dark">
  <div class="container">
    <div class="columns">
      <div class="column">
        <img src="/footer.svg" alt="">
        
      </div>

      <div class="column">
        <div class="footer-column">
          <div class="footer-header">
              <h3>Copyright</h3>
          </div>
          <ul class="link-list">
            <li>
              <a>
                <span class="icon"><i class="fa fa-copyright"></i></span>
                Snow Wang - 2019
              </a>
            </li>
              <li>
                <a href="/about">
                  <span class="icon"><i class="fa fa-cube"></i></span>
                  About Me
                </a>
              </li>
          </ul>
        </div>
      </div>

              <div class="column">
        <div class="footer-column">
          <div class="footer-header">
              <h3>Contacts</h3>
          </div>
          <ul class="link-list">
            <li>




            </li>
            <li>
              <a href="mailto:admin@farseer.vip" target="_blank">
                <span class="icon"><i class="fa fa-envelope"></i></span>
                admin@farseer.vip
              </a>
            </li>
          </ul>
        </div>
      </div>
    <div class="column">

        <div class="footer-column">
          <div class="footer-header">
              <h3>Visitor</h3>
          </div>
          <ul class="link-list">






            <li>




                <a href="https://info.flagcounter.com/4ldw"><img src="https://s11.flagcounter.com/count/4ldw/bg_444F60/txt_FFF7FC/border_FAFFFA/columns_3/maxflags_12/viewers_3/labels_1/pageviews_1/flags_0/percent_1/" alt="Flag Counter" border="0"></a>
            </li>
          </ul>
        </div>
      </div>

    </div>
  </div>
</footer>
    <div id="backtotop"><a href="#"></a></div><div class="sidebar">
  <div class="sidebar-header"><img src="/sidebar.svg" alt="">
    
    <a class="sidebar-close" href="javascript:void(0);">
      <i data-feather="x"></i>
    </a>
  </div>
  <div class="inner">
    <ul class="sidebar-menu">
      <li class="no-children">
          <a href="/tags">
            <div class="columns">
              <table width="100%">  
                <tr>
                  <td class="">
                    <span class="icon"><i class="fa fa-cubes"></i></span>All Tags
                  </td>
                  <td class="has-text-right" >
                      
                  </td>
                </tr>
              </table>
            </div>
          </a>
      <li class="no-children">
          <a href="/tags/diary">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>Diary</td>
                    <td class="has-text-right" >
                        <div class="tag-number">48</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/baidu">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>Baidu</td>
                    <td class="has-text-right" >
                        <div class="tag-number">40</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/renren">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>RenRen</td>
                    <td class="has-text-right" >
                        <div class="tag-number">8</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/jsssc">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>Jsssc</td>
                    <td class="has-text-right" >
                        <div class="tag-number">2</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/pycharm">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>PyCharm</td>
                    <td class="has-text-right" >
                        <div class="tag-number">1</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/python">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>Python</td>
                    <td class="has-text-right" >
                        <div class="tag-number">1</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li></ul>
  </div>
</div>


<script src="/js/jquery-2.2.4.js"></script>
<script src="/js/feather.4.22.0.js"></script>
<script src="/js/modernizr-2.8.3.js"></script>
<script src="/js/refresh.js"></script>
<script src="/js/highlight.9.15.8.pack.js"></script>
<script src="/js/highlightjs-line-numbers.2.7.0.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('.codeinline').forEach((block) => {
      hljs.highlightBlock(block);
    });
  });
</script>



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</body>
</html>